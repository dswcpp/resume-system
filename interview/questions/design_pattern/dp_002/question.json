{
  "id": "dp_002",
  "question": "生产者-消费者模式怎么设计？哪里用过？",
  "tags": [
    "生产者消费者",
    "多线程",
    "无锁队列"
  ],
  "difficulty": 2,
  "hint": "线程安全队列解耦;初始mutex+cv,热点改SPSC",
  "answer": "**生产者-消费者**模式通过一个**线程安全**的缓冲队列解耦数据的生产和消费。生产者往队列写数据，消费者从队列读数据，两者速率可以不同，队列起到削峰缓冲作用。基础实现用**mutex**+condition_variable保护共享队列：生产者加锁后push并notify，消费者wait直到队列非空再pop。问题是高频场景下mutex竞争成为性能瓶颈。优化方案：当只有一个生产者一个消费者时(**SPSC**)，可用无锁环形队列——利用原子变量维护读写位置，**CAS**操作替代互斥锁，吞吐量可提升5-10倍。我在T95项目中的数据管线就经历了这个演进：初始用mutex+cv实现队列，**profiling**发现锁竞争是热点后改为SPSC**无锁队列**，数据处理延迟从**2ms**降到**0.**3ms****。",
  "source": "设计模式面试回答模板.md"
}