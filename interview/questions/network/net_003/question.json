{
  "id": "net_003",
  "question": "TCP粘包是什么？怎么处理？",
  "tags": [
    "TCP",
    "粘包",
    "帧格式",
    "状态机"
  ],
  "difficulty": 2,
  "hint": "TCP字节流无消息边界;解决:包头+长度+数据+CRC+状态机解析",
  "answer": "TCP是字节流协议，没有消息边界概念。发送方多次write的数据可能被合并成一次到达(**粘包**)，或一次write的数据被拆成多次到达(**拆包**)。原因包括Nagle算法合并小包、接收方读取速度慢导致缓冲区积压、MSS/MTU限制导致分片。常见处理方案：1)固定长度消息，简单但浪费；2)特殊分隔符如换行，HTTP头用CRLF；3)定长包头+长度字段+数据体，最通用。我在项目中采用方案3，**帧格式**为0x55AA魔数+地址+命令+数据长度+数据+CRC16校验，配合**状态机**逐字节解析。状态机经历WAIT_HEADER→WAIT_ADDR→WAIT_CMD→WAIT_LEN→WAIT_DATA→WAIT_CRC各状态，天然适配流式数据处理，任何位置的拆包粘包都能正确解析。",
  "source": "TCP详解.md"
}