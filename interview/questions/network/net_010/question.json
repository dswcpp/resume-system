{
  "id": "net_010",
  "question": "如何设计串口/USB通信协议？丢包和校验怎么处理？",
  "tags": ["协议设计", "CRC", "重发", "状态机"],
  "difficulty": 2,
  "hint": "统一帧格式+状态机解析+超时重发+错误计数",
  "answer": "协议设计要素：1)帧格式定义，包含帧头(魔数如0x55AA用于同步)、地址(区分设备)、命令(操作类型)、长度(数据部分字节数)、数据(可变长)、校验(CRC16保证完整性)。2)状态机解析，逐字节推进状态(WAIT_HEADER→WAIT_ADDR→WAIT_CMD→WAIT_LEN→WAIT_DATA→WAIT_CRC)，天然适配字节流的粘包拆包。3)可靠性保证：CRC16检测传输错误，序列号匹配请求和响应，超时重发机制(应答超时自动重发最多N次)，错误计数达到阈值触发重连。4)设计原则：帧格式统一便于复用，解析器独立于业务逻辑，重发策略可配置。我在T95和PCB喷码机项目中都用此模式，协议解析封装为独立模块跨项目复用。",
  "source": "设备通信面试回答模板.md"
}
